pipeline{
         agent any
       tools{
            maven 'maven 3.9.5'
             }
       stages{
        stage ('git checkout'){
            steps{
            git branch: 'master', url: 'https://github.com/gopilavuri/SimpleWebApp.git'
                  }
         }
             stage ('Build') {
             steps {
                sh 'mvn clean package'
                    }
                  }
             stage ('copy to s3 bucket'){
                  steps{
                sh 'whoami'
                 sh 'aws s3 cp /var/lib/jenkins/workspace/test-pipeline-webserver/server/target/server.jar s3://test-pipeline-webserver/'
                        }
                     }
                  stage ('deploy') {
             steps {
                sshagent(['deploye_user']) {
 // sh 'ssh -o StrictHostKeyChecking=no ubuntu@3.27.192.95 mkdir /home/ubuntu/new'
    sh 'scp -o StrictHostKeyChecking=no /var/lib/jenkins/workspace/project-webserver/webapp/target/webapp.war ubuntu@3.27.192.95:/home/ubuntu/apache-tomcat-10.1.15/webapps'
        }
                    }
                  }
                   }
                 }

